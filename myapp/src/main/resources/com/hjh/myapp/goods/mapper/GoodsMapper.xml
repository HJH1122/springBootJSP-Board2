<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org/dtd/mybatis-3-mapper.dtd"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.hjh.myapp.goods.mapper.GoodsMapper">

	<select id="list" resultType="com.hjh.myapp.goods.vo.GoodsVO">
		SELECT
		    g.goods_no,
		    g.goods_name,
		    p.price,
		    p.discount,
		    p.discount_rate,
		    g.hit,
		    g.image_name
		FROM goods g
		LEFT JOIN price p
		    ON g.goods_no = p.goods_no
		    AND p.sale_startDate <![CDATA[ <= ]]> CURDATE()
		    AND CURDATE() <![CDATA[ <= ]]> p.sale_endDate
		ORDER BY g.goods_no DESC
		LIMIT #{perPageNum} OFFSET #{limit}
	</select>
	
	<select id="getTotalRow" parameterType="com.hjh.myapp.util.page.PageObject" resultType="int">
	    SELECT COUNT(*)
	    FROM goods
	</select>
	
	<insert id="writeBig">
	    INSERT INTO category (cate_code1, cate_code2, cate_name)
	    SELECT
	        IFNULL(MAX(cate_code1), 0) + 1,
	        0,
	        #{cate_name}
	    FROM (
	        SELECT cate_code1
	        FROM category
	    ) t
	</insert>
	
	<insert id="writeMid">
	    INSERT INTO category (cate_code1, cate_code2, cate_name)
	    SELECT
	        #{cate_code1},
	        IFNULL(MAX(cate_code2), 0) + 1,
	        #{cate_name}
	    FROM (
	        SELECT cate_code2
	        FROM category
	        WHERE cate_code1 = #{cate_code1}
	    ) t
	</insert>
	
	<update id="update">
		UPDATE category
		SET 
			cate_name = #{cate_name}
		WHERE cate_code1 = #{cate_code1} and cate_code2 = #{cate_code2}
		
	</update>
	
	<delete id="delete">
		DELETE from category
		WHERE 
			cate_code1 = #{cate_code1}
		
		<if test="cate_code2 != 0">
	    	and cate_code2 = #{cate_code2}
	    </if>
	</delete>
	
	
</mapper>